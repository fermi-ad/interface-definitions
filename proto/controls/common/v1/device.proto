// Defines a message that can represent any type used by ACNET and
// EPICS devices.
//
// Protocols that need to receive or provide device data should import
// this file so they have an up-to-date representation of the device
// types we're using. As we add more types, dependent protocols will
// add them to their set (when rebuilt.)

//adding comment for testing purpose
syntax = "proto3";

//  quiet warnings for the time being
// import "google/protobuf/timestamp.proto";

package common.device;

// Holds a value that can be sent to a device to be received by
// reading a device.

message Value {

    // Represents an array of floating point values.
    //
    // This needs to be a message because `oneof` fields don't allow
    // the `repeated` keyword to be specified. This message type is
    // used for ACNET array devices and EPICS waveform PVs.

    message ScalarArray {
        repeated double value = 1;
    }

    // Represents an array of strings.
    //
    // This needs to be a message because `oneof` fields don't allow
    // the `repeated` keyword to be specified.

    message TextArray {
        repeated string value = 1;
    }

    // DEPRECATED. A message which is opinionated towards ACNET analog
    // alarm structures. This will be replaced by a message that can
    // represent both ACNET and EPICS alarms.

    message AnalogAlarm {
        double minimum = 1;
        double maximum = 2;
        bool alarmEnable = 3;
        bool alarmStatus = 4;
        bool abort = 5;
        bool abortInhibit = 6;
        uint32 triesNeeded = 7;
        uint32 triesNow = 8;
    }

    // DEPRECATED. A message which is opinionated towards ACNET
    // digital alarm structures. This will be replaced by a message
    // that can represent both ACNET and EPICS alarms.

    message DigitalAlarm {
        int32 nominal = 1;
        uint32 mask = 2;
        bool alarmEnable = 3;
        bool alarmStatus = 4;
        bool abort = 5;
        bool abortInhibit = 6;
        uint32 triesNeeded = 7;
        uint32 triesNow = 8;
    }

    // DEPRECATED. A message which is opinionated towards ACNET status
    // definitions. This will be replaced by a more generic message
    // that can be used by ACNET and EPICS devices.

    message BasicStatus {
        map<string, string> value = 1;
    }

    //  Represents the occurence of one of several types of alarms
    //      1) ACNET Analog Alarm
    //      1) ACNET Digital Alarm - one bit or set of bits
    //      1) EPICS PV Alarm

    message Alarm {
        enum Status {
            STAT_NONE = 0;      //  No alarm (should never be seen)
            STAT_HIHI = 1;      //  High-high limit exceeded
            STAT_HIGH = 2;      //  High limit exceeded
            STAT_LOW  = 3;      //  Lower than low limit
            STAT_LOLO = 4;      //  Lower than low-low limit
            STAT_BOOL = 5;      //  Boolean alarm
        }
        enum Severity {
            SEV_NONE  = 0;      //  No alarm (should never be seen)
            SEV_EVENT = 1;      //  An informational alarm
            SEV_MINOR = 2;      //  An alarm of minor importance
            SEV_MAJOR = 3;      //  An alarm of major importance
        }
        Status status = 1;
        Severity severity = 2;
        bool enabled = 3;           //  true: this alarm should be indicated and/or annunciated if criteria are met
        bool bypassed = 4;          //  true: this alarm should be indicated but not annunciated if criteria are met
        bool acknowledged = 5;      //  true: this alarm has been acknowledged by a client
        uint32 snoozeMillis = 6;    //  set by client and decremented by front-end
        string text = 7;
        string url = 8;
        //  priority        //  arbitrary integer for comparing ACNET alarms
        //  sound
        //  speech
        //  handler code    //  ACNET concept ?
    }

    message AlarmArray {
        repeated Alarm alarm = 1;
    }

    // A device value can only be one of these types.

    oneof value {
        double scalar = 1;
        ScalarArray scalarArr = 2;
        bytes raw = 3;
        string text = 4;
        TextArray textArr = 5;
        AnalogAlarm anaAlarm = 6;
        DigitalAlarm digAlarm = 7;
        BasicStatus basicStatus = 8;
        Alarm alarm = 9;
        AlarmArray alarmArr = 10;
    }
}
