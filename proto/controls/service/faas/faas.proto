syntax = "proto3";

package services.faas;

// high-level RPC to manage Fission resources

service FissionManager {
  // Function operation using inline code (python/handler) and environment name.
  rpc CreateFunction(CreateFunctionRequest) returns (GenericResponse);
  rpc DeleteFunction(DeleteFunctionRequest) returns (GenericResponse);

  // HTTP trigger operation to expose function via Fission router
  rpc CreateHTTPTrigger(CreateHTTPTriggerRequest) returns (GenericResponse);
  rpc DeleteHTTPTrigger(DeleteHTTPTriggerRequest) returns (GenericResponse);

  // Create timer trigger (cron-like spec)
  rpc CreateTimerTrigger(CreateTimerTriggerRequest) returns (GenericResponse);
  rpc DeleteTimerTrigger(DeleteTimerTriggerRequest) returns (GenericResponse);

  // Create message queue trigger for kafka
  rpc CreateMessageQueueTrigger(CreateMQTriggerRequest) returns (GenericResponse);
  rpc DeleteMessageQueueTrigger(DeleteMQTriggerRequest) returns (GenericResponse);
}

message GenericResponse {
  bool success = 1;
  string message = 2;
  int32 exit_code = 3;
  string details = 4;
}


// CreateFunction (inline code)
message CreateFunctionRequest {
  string name = 1;
  string environment = 2;
  string source_type = 3; // "python"|"binary"|"archive" etc.
  string entrypoint = 4;  // e.g., "handler" or executable
  string code = 5;        // inline code or base64 if binary (we use plain text for small examples)
  string url_path = 6;    // optional http path (for http trigger)
}

// DeleteFunction (inline code)
message DeleteFunctionRequest {
  string name = 1;
  string url_path = 2;    // optional http path (for http trigger)
}

// CreateHTTPTrigger
message CreateHTTPTriggerRequest {
  string name = 1;
  string function_name = 2;
  string route = 3;    // e.g. "/myfunc"
  string method = 4;   // GET, POST etc.
}

// DeleteHTTPTrigger
message DeleteHTTPTriggerRequest {
  string name = 1;
}

// CreateTimerTrigger
message CreateTimerTriggerRequest {
  string name = 1;
  string function_name = 2;
  string cron = 3;     // cron spec, e.g. "*/5 * * * *"
}

// DeleteTimerTrigger
message DeleteTimerTriggerRequest {
  string name = 1;
}

// Create Message Queue (Kafka) Trigger
message CreateMQTriggerRequest {
  string name = 1;
  string function_name = 2;
  string topic = 3;
  string broker = 4;  // e.g. "kafka:9092"
  int32 partition = 5;
}

// Delete Message Queue (Kafka) Trigger
message DeleteMQTriggerRequest {
  string name = 1;
}

